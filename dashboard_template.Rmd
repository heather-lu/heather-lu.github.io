---
title: "Flexdashboard"
output: 
  flexdashboard::flex_dashboard:
    orientation: rows
    vertical_layout: fill
    theme: cerulean
runtime: shiny
---

```{r setup, include = FALSE}
library(flexdashboard)
library(tidyverse)
library(plotly)
library(p8105.datasets)
data("instacart")
```

## Figure 1: Aisles with Over 10K Items Ordered {data-width=650}

```{r figure1, echo = FALSE, warning = FALSE}
num_aisle = instacart |> 
  count(aisle, name = "n_obs") |> 
  filter(n_obs > 10000) |> 
  mutate(aisle = fct_reorder(aisle, n_obs)) |> 
  ggplot(aes(x = aisle, y = n_obs, fill = aisle)) +
  geom_col() +
  coord_flip() +
  labs(
    title = "Aisles With Over 10000 Items Ordered",
    x = "Aisle Names",
    y = "Number of of Items Ordered"
  ) +
  viridis::scale_color_viridis(discrete = TRUE) +
  theme_minimal() +
  theme(legend.position = "none")

ggplotly(num_aisle)
```

-----------------------------------------------------------------------

### Figure 2: Average order hour by day of week for Pink Lady Apples and Coffee Ice Cream {data-width=650}

```{r figure2, echo = FALSE, warning = FALSE}
dow_levels <- c("Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday")

instacart |>
  filter(product_name %in% c("Pink Lady Apples", "Coffee Ice Cream")) |>
  group_by(product_name, order_dow) |>
  summarise(mean_hour = mean(order_hour_of_day, na.rm = TRUE), .groups = "drop") |>
  mutate(
    day = recode(as.character(order_dow),
                 `0`="Sunday", `1`="Monday", `2`="Tuesday", `3`="Wednesday",
                 `4`="Thursday", `5`="Friday", `6`="Saturday"),
    day = factor(day, levels = dow_levels)
  ) |>
  arrange(product_name, day) |>
  plot_ly(
    x = ~day, y = ~mean_hour, color = ~product_name,
    type = "scatter", mode = "lines+markers",
    text = ~product_name,
    hovertemplate = "%{text}<br>%{x}: %{y:.2f}:00<extra></extra>"
  ) |>
  layout(
    title = "Average Order Hour by Day of Week",
    xaxis = list(
      title = "Day of week",
      categoryorder = "array",
      categoryarray = dow_levels
    ),
    yaxis = list(title = "Average order hour (0–23)")
  )
```

-----------------------------------------------------------------------

### Figure 3: Orders by hour of day {data-width=650}

```{r figure3, echo = FALSE, warning = FALSE}
instacart |>
  count(order_hour_of_day, name = "orders") |>
  plot_ly(x = ~order_hour_of_day, y = ~orders,
          type = "scatter", mode = "markers") |>
  layout(title = "Instacart Activity by Hour",
         xaxis = list(title = "Hour of day (0–23)",
                      tickvals = c(0,6,12,18,23)),
         yaxis = list(title = "Number of order lines"))
```